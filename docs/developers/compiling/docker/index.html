<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="/heron/img/favicon-16x16.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="/heron/img/favicon-32x32.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.15"><title>Heron Documentation - Compiling With Docker</title><link rel="stylesheet" href="/heron/css/style.min.css"><link rel="stylesheet" href="/heron/css/font-awesome.min.css"><link rel="stylesheet" href="/heron/css/pygments.css"><script defer src="http://code.jquery.com/jquery-2.2.1.min.js"></script><script defer src="/heron/js/app.min.js"></script></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="/heron/"><img class="pull-left" src="/heron/img/HeronTextLogo-small.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/heron/docs/getting-started">Docs</a></li><li><a href="/heron/docs/resources">Resources</a></li><li><a href="/heron/docs/contributors/community">Community</a></li><li><a href="https://github.com/twitter/heron">GitHub</a></li><li><a class="nav-icon" href="https://groups.google.com/forum/#!forum/heron-users"><i class="fa fa-comments"></i></a></li><li><a class="nav-icon" href="https://twitter.com/heronstreaming"><i class="fa fa-twitter"></i></a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-3 col-md-3 col-lg-2 collapse"><div><nav class="hn-sidebar-nav"><h4>Getting Started</h4><ul><li><a href="/heron/docs/getting-started">Local (Single Node)</a></li><li><a href="/heron/docs/upgrade-storm-to-heron">Upgrade Storm Topologies</a></li></ul><ul></ul><h4>Heron Concepts</h4><ul><li><a href="/heron/docs/concepts/topologies">Heron Topology</a></li><li><a href="/heron/docs/concepts/architecture">Heron Architecture</a></li></ul><ul></ul><h4>Deployment</h4><ul><li><a href="/heron/docs/operators/deployment">Overview</a></li><li><a href="/heron/docs/operators/deployment/configuration">Configuration</a></li></ul><ul></ul><h4>State Managers</h4><ul><li><a href="/heron/docs/operators/deployment/statemanagers/zookeeper">Zookeeper</a></li><li><a href="/heron/docs/operators/deployment/statemanagers/localfs">Local FS</a></li></ul><ul></ul><h4>Uploaders</h4><ul><li><a href="/heron/docs/operators/deployment/uploaders/localfs">Local FS</a></li><li><a href="/heron/docs/operators/deployment/uploaders/hdfs">HDFS</a></li><li><a href="/heron/docs/operators/deployment/uploaders/s3">Amazon S3</a></li></ul><ul></ul><h4>Schedulers</h4><ul><li><a href="/heron/docs/operators/deployment/schedulers/aurora">Aurora Cluster</a></li><li><a href="/heron/docs/operators/deployment/schedulers/local">Local Cluster</a></li><li><a href="/heron/docs/operators/deployment/schedulers/slurm">Slurm Cluster</a></li></ul><ul></ul><h4>Cluster Configuration</h4><ul><li><a href="/heron/docs/operators/configuration/config-intro">Overview</a></li><li><a href="/heron/docs/operators/configuration/system">System-Level</a></li><li><a href="/heron/docs/operators/configuration/instance">Heron Instance</a></li><li><a href="/heron/docs/operators/configuration/metrics-manager">Metrics Manager</a></li><li><a href="/heron/docs/operators/configuration/stmgr">Stream Manager</a></li><li><a href="/heron/docs/operators/configuration/tmaster">Topology Master</a></li></ul><ul></ul><h4>Observability</h4><ul><li><a href="/heron/docs/operators/observability/graphite">Graphite</a></li></ul><ul></ul><h4>User Manuals</h4><ul><li><a href="/heron/docs/operators/heron-cli">Heron Client</a></li><li><a href="/heron/docs/operators/heron-tracker-api">Heron Tracker REST API</a></li><li><a href="/heron/docs/operators/heron-tracker">Heron Tracker Runbook</a></li><li><a href="/heron/docs/operators/heron-ui">Heron UI Runbook</a></li></ul><ul></ul><h4>Topology Writers</h4><ul><li><a href="/heron/docs/developers/topologies">Writing Topologies</a></li><li><a href="/heron/docs/developers/data-model">Heron Data Model</a></li><li><a href="/heron/docs/developers/serialization">Tuple Serialization</a></li><li><a href="/heron/docs/developers/ui-guide">Heron UI Guide</a></li><li><a href="/heron/docs/developers/tuning">Tuning Guide</a></li><li><a href="/heron/docs/developers/simulator-mode">Simulator Mode</a></li><li><a href="/heron/docs/developers/troubleshooting">Troubleshooting Guide</a></li><li><a href="/heron/api">Javadoc</a></li></ul><ul></ul><h4>Heron Developers</h4><ul><li><a href="/heron/docs/developers/compiling/compiling">Compiling</a></li><li><a href="/heron/docs/developers/compiling/linux">Compiling on Linux</a></li><li><a href="/heron/docs/developers/compiling/mac">Compiling on Mac OS X</a></li><li><a href="/heron/docs/developers/compiling/docker">Compiling With Docker</a></li><li><a href="/heron/docs/contributors/testing">Running Tests</a></li><li><a href="/heron/docs/contributors/codebase">Code Organization</a></li></ul><ul></ul><h4>Extending Heron</h4><ul><li><a href="/heron/docs/contributors/custom-scheduler">Custom Scheduler</a></li><li><a href="/heron/docs/contributors/custom-metrics-sink">Custom Metrics Sink</a></li></ul><ul></ul><h4>Heron Resources</h4><ul><li><a href="/heron/docs/resources">Heron Resources</a></li></ul><ul></ul><h4>Contributors</h4><ul><li><a href="/heron/docs/contributors/community">Community</a></li><li><a href="/heron/docs/contributors/governance">Governance</a></li></ul><ul></ul></nav></div></aside><section class="hn-docs-main col-sm-9 col-md-9 col-lg-10 col-sm-offset-3 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Compiling With Docker</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>For developing Heron, you will need to compile it for the environment that you
want to use it in. If you&rsquo;d like to use Docker to create that build environment,
Heron provides a convenient script to make that process easier.</p>

<p>Currently, only Ubuntu 14.04, Ubuntu 15.10, and CentOS 7 are supported, but if you
need another platform there are instructions for adding new ones
<a href="#contributing-new-environments">below</a>.</p>

<h3 id="requirements:69e60651f42783a7df723575c4088b5b">Requirements</h3>

<ul>
<li><a href="https://docs.docker.com">Docker</a></li>
</ul>

<h3 id="running-docker-in-a-virtual-machine:69e60651f42783a7df723575c4088b5b">Running Docker in a Virtual Machine</h3>

<p>If you are running Docker in a virtual machine (VM), it is recommended that you
adjust your settings to help speed up the build. To do this, open
<a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> and go to the container
in which Docker is running (usually &ldquo;default&rdquo; or whatever name you used to
create the VM), click on the VM, and then click on <strong>Settings</strong>.</p>

<p><strong>Note</strong>: You will need to stop the VM before modifying these settings.</p>

<p><img src="/heron/img/virtual-box-processors.png" alt="VirtualBox Processors" />
<img src="/heron/img/virtual-box-memory.png" alt="VirtualBox Memory" /></p>

<h2 id="building-heron:69e60651f42783a7df723575c4088b5b">Building Heron</h2>

<p>Heron provides a <code>build-arfifacts.sh</code> script for Docker located in the
<code>docker</code> folder. To run that script:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>$ <span style="color: #336666">cd</span> /path/to/heron/repo
$ docker/build-artifacts.sh
</pre></div>

<p>Running the script by itself will display usage information:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>Usage<span style="color: #555555">:</span> docker<span style="color: #555555">/</span>build<span style="color: #555555">-</span>artifacts<span style="color: #555555">.</span><span style="color: #330099">sh</span> <span style="color: #555555">&lt;</span>platform<span style="color: #555555">&gt;</span> <span style="color: #555555">&lt;</span>version_string<span style="color: #555555">&gt;</span> <span style="color: #555555">[</span>source<span style="color: #555555">-</span>tarball<span style="color: #555555">]</span> <span style="color: #555555">&lt;</span>output<span style="color: #555555">-</span>directory<span style="color: #555555">&gt;</span> 
  
Platforms Supported<span style="color: #555555">:</span> darwin<span style="color: #555555">,</span> ubuntu14<span style="color: #555555">.</span><span style="color: #FF6600">04</span><span style="color: #555555">,</span> ubuntu15<span style="color: #555555">.</span><span style="color: #FF6600">10</span><span style="color: #555555">,</span> centos7
  
Example<span style="color: #555555">:</span>
  <span style="color: #555555">./</span>build<span style="color: #555555">-</span>artifacts<span style="color: #555555">.</span><span style="color: #330099">sh</span> ubuntu14<span style="color: #555555">.</span><span style="color: #FF6600">04</span> <span style="color: #FF6600">0.12</span><span style="color: #555555">.</span><span style="color: #FF6600">0</span> <span style="color: #555555">.</span>
  
NOTE<span style="color: #555555">:</span> If running on OSX<span style="color: #555555">,</span> the output directory will need to 
      be under <span style="color: #555555">/</span>Users so virtualbox has access to<span style="color: #555555">.</span>
</pre></div>

<p>The following arguments are required:</p>

<ul>
<li><code>platform</code> &mdash; Currently, this can be one of: <code>ubuntu14.04</code>, <code>centos7</code>. You
can add other platforms using the <a href="#contributing-new-environments">instructions
below</a>.</li>
<li><code>version-string</code> &mdash; The Heron release for which you&rsquo;d like to build
artifacts.</li>
<li><code>output-directory</code> &mdash; The directory in which you&rsquo;d like the release to be
built.</li>
</ul>

<p>Here&rsquo;s an example usage:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>$ docker/build-artifacts.sh ubuntu14.04 0.12.0 ~/heron-release
</pre></div>

<p>This will build a Docker container specific to Ubuntu 14.04, create a source
tarball of the Heron repository, run a full release build of Heron, and then
copy the artifacts into the <code>~/heron-release</code> directory.</p>

<p>Optionally, you can also include a tarball of the Heron source if you have one.
By default, the script will create a tarball of the current source in the Heron
repo and use that to build the artifacts.</p>

<p><strong>Note</strong>: If you are running on Mac OS X, Docker must be run inside a VM.
Therefore, you must make sure that both the source tarball and destination
directory are somewhere under your home directory. For example, you cannot
output the Heron artifacts to <code>/tmp</code> because <code>/tmp</code> refers to the directory
inside the VM, not on the host machine. Your home directory, however, is
automatically linked in to the VM and can be accessed normally.</p>

<p>After the build has completed, you can go to your output directory and see all
of the generated artifacts:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>$ ls ~/heron-release
heron-api-0.12.0-ubuntu14.04.tar.gz
heron-client-0.12.0-ubuntu14.04.tar.gz 
heron-tools-0.12.0-ubuntu14.04.tar.gz
heron-client-install-0.12.0-ubuntu.sh  
heron-tools-install-0.12.0-ubuntu.sh
heron-api-install-0.12.0-ubuntu.sh     
heron-core-0.12.0-ubuntu.tar.gz
</pre></div>

<h2 id="contributing-new-environments:69e60651f42783a7df723575c4088b5b">Contributing New Environments</h2>

<p>You&rsquo;ll notice that there are multiple
<a href="https://docs.docker.com/engine/reference/builder/">Dockerfiles</a> in the <code>docker</code>
directory of Heron&rsquo;s source code, one for each of the currently supported
platforms.</p>

<p>To add support for a new platform, add a new <code>Dockerfile</code> to that directory and
append the name of the platform to the name of the file. If you&rsquo;d like to add
support for Debian 8, for example, add a file named <code>Dockerfile.debian8</code>. Once
you&rsquo;ve done that, follow the instructions in the <a href="https://docs.docker.com/engine/articles/dockerfile_best-practices/">Docker
documentation</a>.</p>

<p>You should make sure that your <code>Dockerfile</code> specifies <em>at least</em> all of the
following:</p>

<h4 id="step-1-the-os-being-used-in-a-from-https-docs-docker-com-engine-reference-builder-from-statement:69e60651f42783a7df723575c4088b5b">Step 1 - The OS being used in a <a href="https://docs.docker.com/engine/reference/builder/#from"><code>FROM</code></a> statement.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">FROM</span><span style="color: #CC3300"> centos:centos7</span>
</pre></div>

<h4 id="step-2-a-target-platform-environment-variable-using-the-env-https-docs-docker-com-engine-reference-builder-env-instruction:69e60651f42783a7df723575c4088b5b">Step 2 - A <code>TARGET_PLATFORM</code> environment variable using the <a href="https://docs.docker.com/engine/reference/builder/#env"><code>ENV</code></a> instruction.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">ENV</span><span style="color: #CC3300"> TARGET_PLATFORM centos</span>
</pre></div>

<h4 id="step-3-a-general-dependency-installation-script-using-a-run-https-docs-docker-com-engine-reference-builder-run-instruction:69e60651f42783a7df723575c4088b5b">Step 3 - A general dependency installation script using a <a href="https://docs.docker.com/engine/reference/builder/#run"><code>RUN</code></a> instruction.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">RUN</span> apt-get update <span style="color: #555555">&amp;&amp;</span> apt-get -y install <span style="color: #CC3300; font-weight: bold">\</span>
         automake <span style="color: #CC3300; font-weight: bold">\</span>
         build-essential <span style="color: #CC3300; font-weight: bold">\</span>
         cmake <span style="color: #CC3300; font-weight: bold">\</span>
         curl <span style="color: #CC3300; font-weight: bold">\</span>
         libssl-dev <span style="color: #CC3300; font-weight: bold">\</span>
         git <span style="color: #CC3300; font-weight: bold">\</span>
         libtool <span style="color: #CC3300; font-weight: bold">\</span>
         libunwind8 <span style="color: #CC3300; font-weight: bold">\</span>
         libunwind-setjmp0-dev <span style="color: #CC3300; font-weight: bold">\</span>
         python <span style="color: #CC3300; font-weight: bold">\</span>
         python2.7-dev <span style="color: #CC3300; font-weight: bold">\</span>
         python-software-properties <span style="color: #CC3300; font-weight: bold">\</span>
         software-properties-common <span style="color: #CC3300; font-weight: bold">\</span>
         python-setuptools <span style="color: #CC3300; font-weight: bold">\</span>
         unzip <span style="color: #CC3300; font-weight: bold">\</span>
         wget
</pre></div>

<h4 id="step-4-an-installation-script-for-java-8-and-a-java-home-environment-variable:69e60651f42783a7df723575c4088b5b">Step 4 - An installation script for Java 8 and a <code>JAVA_HOME</code> environment variable.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">RUN</span> <span style="color: #CC3300; font-weight: bold">\</span>
     <span style="color: #336666">echo</span> oracle-java8-installer shared/accepted-oracle-license-v1-1 <span style="color: #006699; font-weight: bold">select</span> <span style="color: #336666">true</span> | debconf-set-selections <span style="color: #555555">&amp;&amp;</span> <span style="color: #CC3300; font-weight: bold">\</span>
     add-apt-repository -y ppa:webupd8team/java <span style="color: #555555">&amp;&amp;</span> <span style="color: #CC3300; font-weight: bold">\</span>
     apt-get update <span style="color: #555555">&amp;&amp;</span> <span style="color: #CC3300; font-weight: bold">\</span>
     apt-get install -y oracle-java8-installer <span style="color: #555555">&amp;&amp;</span> <span style="color: #CC3300; font-weight: bold">\</span>
     rm -rf /var/lib/apt/lists/* <span style="color: #555555">&amp;&amp;</span> <span style="color: #CC3300; font-weight: bold">\</span>
     rm -rf /var/cache/oracle-jdk8-installer

<span style="color: #006699; font-weight: bold">ENV</span><span style="color: #CC3300"> JAVA_HOME /usr/lib/jvm/java-8-oracle</span>
</pre></div>

<h4 id="step-5-an-installation-script-for-bazel-http-bazel-io-version-0-1-2-or-above:69e60651f42783a7df723575c4088b5b">Step 5 - An installation script for <a href="http://bazel.io/">Bazel</a> version 0.1.2 or above.</h4>

<p>Here&rsquo;s an example:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">RUN</span> wget -O /tmp/bazel.sh https://github.com/bazelbuild/bazel/releases/download/0.1.2/bazel-0.1.2-installer-linux-x86_64.sh <span style="color: #CC3300; font-weight: bold">\</span>
         <span style="color: #555555">&amp;&amp;</span> chmod +x /tmp/bazel.sh <span style="color: #CC3300; font-weight: bold">\</span>
         <span style="color: #555555">&amp;&amp;</span> /tmp/bazel.sh
</pre></div>

<h4 id="step-6-add-the-bazelrc-configuration-file-for-bazel-and-the-compile-sh:69e60651f42783a7df723575c4088b5b">Step 6 - Add the <code>bazelrc</code> configuration file for Bazel and the <code>compile.sh</code></h4>

<p>script (from the <code>docker</code> folder) that compiles Heron:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">ADD</span><span style="color: #CC3300"> bazelrc /root/.bazelrc</span>
<span style="color: #006699; font-weight: bold">ADD</span><span style="color: #CC3300"> compile.sh /compile.sh</span>
</pre></div>
</article></section></div></div></div></body></html>